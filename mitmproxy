#!/usr/bin/env python
import sys, argparse, os
from libmproxy import proxy, console, utils

if __name__ == '__main__':
    utils.check_netlib_version_equality()
    parser = argparse.ArgumentParser(usage = "%(prog)s [options]")
    console.ConsoleMaster.add_arguments(parser)

    options = parser.parse_args()
    server = proxy.get_server(options)

    spec = ""
    for i in ["LANG", "LC_CTYPE", "LC_ALL"]:
        spec += os.environ.get(i, "").lower()
    if "utf" not in spec:
        print >> sys.stderr, "Error: mitmproxy requires a UTF console environment."
        print >> sys.stderr, "Set your LANG enviroment variable to something like en_US.UTF-8"
        sys.exit(1)

    m = console.ConsoleMaster(server, options)
    try:
        m.run()
    except KeyboardInterrupt:
        pass
